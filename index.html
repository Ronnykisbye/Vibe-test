<!DOCTYPE html>
<html lang="da">
<head>
  <!-- Afsnit 01 ‚Äì Grundops√¶tning -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spilletid ‚Äì B√∏rnefodbold</title>

  <style>
    /* Afsnit 02 ‚Äì Tema variabler (lys/m√∏rk) */

    :root {
      --bg: #020617;
      --fg: #e5e7eb;
      --card-bg: #020617;
      --card-border: #1f2937;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.12);
      --danger: #ef4444;
      --muted: #9ca3af;
      --topbar-bg: #020617;
      --topbar-fg: #e5e7eb;
      --button-bg: #111827;
      --button-fg: #e5e7eb;
      --button-soft: #1f2937;
      --shadow-soft: 0 14px 30px rgba(0, 0, 0, 0.45);
    }

    body.theme-light {
      --bg: #f4f5f7;
      --fg: #111827;
      --card-bg: #ffffff;
      --card-border: #e5e7eb;
      --accent: #2563eb;
      --accent-soft: rgba(37, 99, 235, 0.08);
      --danger: #dc2626;
      --muted: #6b7280;
      --topbar-bg: #ffffff;
      --topbar-fg: #111827;
      --button-bg: #e5e7eb;
      --button-fg: #111827;
      --button-soft: #e5e7eb;
      --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.08);
    }

    body.theme-dark {
      /* v√¶rdierne fra :root bruges som standard */
    }

    /* Afsnit 03 ‚Äì Basis layout */

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #1e293b 0, var(--bg) 55%);
      color: var(--fg);
      min-height: 100vh;
    }

    .app {
      max-width: 960px;
      margin: 0 auto;
      padding: 0.75rem 0.75rem 1.5rem;
    }

    h1,
    h2,
    h3 {
      margin-top: 0.4rem;
      margin-bottom: 0.4rem;
    }

    p {
      margin-top: 0.2rem;
      margin-bottom: 0.6rem;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 1rem;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--card-border);
      margin-top: 0.75rem;
    }

    .hidden {
      display: none;
    }

    /* Afsnit 04 ‚Äì Topmenu */

    .topbar {
      position: sticky;
      top: 0;
      z-index: 50;
      background: linear-gradient(
        to right,
        var(--topbar-bg),
        rgba(34, 197, 94, 0.15),
        var(--topbar-bg)
      );
      color: var(--topbar-fg);
      padding: 0.45rem 0.75rem;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(12px);
    }

    .topbar-inner {
      max-width: 960px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      font-size: 0.95rem;
    }

    .brand-badge {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 2px solid rgba(34, 197, 94, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      background: radial-gradient(circle at top, #22c55e, #0b1120);
      box-shadow: 0 0 16px rgba(34, 197, 94, 0.8);
    }

    .nav {
      display: flex;
      gap: 0.3rem;
      flex-wrap: wrap;
    }

    .nav-btn {
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 0.35rem 0.7rem;
      font-size: 0.8rem;
      cursor: pointer;
      background: transparent;
      color: var(--topbar-fg);
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      opacity: 0.85;
    }

    .nav-btn span {
      font-size: 0.9em;
    }

    .nav-btn:hover {
      opacity: 1;
      background: rgba(15, 23, 42, 0.4);
    }

    .nav-btn.active {
      border-color: rgba(34, 197, 94, 0.8);
      background: rgba(15, 23, 42, 0.8);
      opacity: 1;
      box-shadow: 0 0 14px rgba(34, 197, 94, 0.6);
    }

    /* St√∏rre og tydeligere kamp-ikon */
    .nav-btn[data-view="match"] span:first-child {
      font-size: 1.4rem;
      filter: drop-shadow(0 0 4px rgba(34, 197, 94, 0.8));
    }

    .topbar-right {
      display: flex;
      gap: 0.3rem;
      align-items: center;
    }

    /* Afsnit 05 ‚Äì Knapper og inputs */

    button {
      border-radius: 999px;
      border: none;
      padding: 0.55rem 1.1rem;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      white-space: nowrap;
      transition: transform 0.05s ease, box-shadow 0.1s ease,
        background 0.1s ease, border-color 0.1s ease;
    }

    button:active {
      transform: translateY(1px) scale(0.99);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), #4ade80);
      color: #022c22;
      border: 1px solid rgba(34, 197, 94, 0.6);
      box-shadow: 0 8px 20px rgba(34, 197, 94, 0.45);
      font-weight: 600;
    }

    .btn-secondary {
      background: var(--button-bg);
      color: var(--button-fg);
      border: 1px solid var(--card-border);
    }

    .btn-soft {
      background: var(--button-soft);
      color: var(--button-fg);
      border: 1px solid transparent;
      font-size: 0.8rem;
      padding: 0.35rem 0.7rem;
    }

    .btn-danger {
      background: var(--danger);
      color: #f9fafb;
      border: 1px solid transparent;
    }

    .btn-pill {
      border-radius: 999px;
    }

    input[type="text"] {
      width: 100%;
      padding: 0.55rem 0.7rem;
      border-radius: 999px;
      border: 1px solid var(--card-border);
      font-size: 0.9rem;
      background: rgba(15, 23, 42, 0.7);
      color: var(--fg);
    }

    body.theme-light input[type="text"] {
      background: #f9fafb;
      color: #111827;
    }

    .input-row {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.6rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .input-row button {
      flex-shrink: 0;
    }

    /* Afsnit 06 ‚Äì Lister og layout */

    .simple-list {
      list-style: none;
      padding-left: 0;
      margin: 0;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .setup-player-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.18rem 0;
    }

    .setup-player-name {
      flex: 1;
    }

    .setup-icons {
      display: inline-flex;
      gap: 0.25rem;
      margin-left: 0.4rem;
    }

    .setup-player-edit,
    .setup-player-remove {
      cursor: pointer;
      font-size: 0.95rem;
      opacity: 0.8;
    }

    .setup-player-edit:hover,
    .setup-player-remove:hover {
      opacity: 1;
      transform: translateY(-1px);
    }

    .columns {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 0.5rem;
    }

    .column {
      flex: 1;
      background: radial-gradient(circle at top left, var(--accent-soft), transparent 55%);
      border-radius: 12px;
      padding: 0.6rem;
      min-height: 90px;
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .column-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.35rem;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--muted);
    }

    .player-column {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    /* Afsnit 07 ‚Äì Spillerknapper */

    .player-btn {
      padding: 0.45rem 0.8rem;
      border-radius: 999px;
      border: 1px solid transparent;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      justify-content: space-between;
      min-width: 120px;
      max-width: 260px;
      background: rgba(15, 23, 42, 0.9);
      color: var(--fg);
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.7);
    }

    .player-content {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.05rem;
    }

    .player-name {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .player-time,
    .player-missing {
      font-size: 0.75rem;
      opacity: 0.9;
    }

    .player-time {
      color: var(--muted);
    }

    .player-missing {
      color: #facc15;
    }

    .player-on {
      background: radial-gradient(circle at top, #22c55e, #065f46);
      border-color: rgba(74, 222, 128, 0.8);
      color: #022c22;
      box-shadow: 0 10px 22px rgba(34, 197, 94, 0.7);
    }

    .player-on .player-time {
      color: #022c22;
      opacity: 0.9;
    }

    .player-off {
      background: radial-gradient(circle at top, #0b1120, #020617);
      border-color: rgba(148, 163, 184, 0.5);
    }

    .player-icons {
      display: inline-flex;
      gap: 0.25rem;
      margin-left: 0.5rem;
      flex-shrink: 0;
    }

    .player-edit,
    .player-remove {
      font-size: 1rem;
      opacity: 0.8;
      cursor: pointer;
    }

    .player-edit:hover,
    .player-remove:hover {
      opacity: 1;
      transform: translateY(-1px);
    }

    /* Lys tilstand ‚Äì g√∏r tekst p√• knapper tydelig */
    body.theme-light .player-btn {
      background: #ffffff;
      border-color: #cbd5e1;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    body.theme-light .player-name,
    body.theme-light .player-time {
      color: #111827 !important;
    }

    /* Afsnit 08 ‚Äì Timer og statistik */

    .timer-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .timer-display {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .timer-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      display: block;
    }

    .match-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-bottom: 0.5rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    th,
    td {
      text-align: left;
      padding: 0.35rem 0.3rem;
    }

    th {
      border-bottom: 1px solid rgba(148, 163, 184, 0.4);
      font-weight: 600;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted);
    }

    tbody tr:nth-child(odd) {
      background: rgba(15, 23, 42, 0.45);
    }

    body.theme-light tbody tr:nth-child(odd) {
      background: #f9fafb;
    }

    tfoot td {
      border-top: 1px solid rgba(148, 163, 184, 0.4);
      font-weight: 600;
    }

    .stats-note {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 0.25rem;
    }

    /* Afsnit 09 ‚Äì Diverse */

    footer {
      text-align: center;
      font-size: 0.75rem;
      color: var(--muted);
      margin: 1rem 0 0.5rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.75rem;
      padding: 0.2rem 0.56rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--muted);
    }

    /* Afsnit 10 ‚Äì Responsivt design */

    @media (min-width: 720px) {
      .columns {
        flex-direction: row;
      }

      .timer-row {
        align-items: center;
      }
    }
  </style>
</head>
<body class="theme-dark">
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="brand-badge">‚öΩ</div>
        <div>B√∏rnefodbold ‚Äì Spilletid</div>
      </div>

      <nav class="nav">
        <button class="nav-btn active" data-view="players">
          <span>üë•</span><span>Spillere</span>
        </button>
        <button class="nav-btn" data-view="match">
          <span>üèüÔ∏è</span><span>Kamp</span>
        </button>
        <button class="nav-btn" data-view="stats">
          <span>üìä</span><span>Statistik</span>
        </button>
      </nav>

      <div class="topbar-right">
        <button id="newMatchTopButton" class="btn-soft">
          üîÅ Ny kamp
        </button>
        <button id="themeToggleButton" class="btn-soft">
          ‚òÄÔ∏è Lys
        </button>
      </div>
    </div>
  </div>

  <div class="app">
    <!-- Afsnit 11 ‚Äì Hjem / spillere -->
    <section id="setupSection" class="card">
      <h1>Holdet f√∏r kampen</h1>
      <p>
        Tilf√∏j alle spillere i truppen. Brug Enter for hurtigt at tilf√∏je en
        spiller. Du kan altid justere listen senere.
      </p>

      <div class="input-row">
        <input
          id="playerNameInput"
          type="text"
          placeholder="Spillernavn (fx Emil)"
        />
        <button id="addPlayerButton" class="btn-primary">
          ‚ûï Tilf√∏j spiller
        </button>
      </div>

      <ul id="playerList" class="simple-list"></ul>

      <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
        <button id="startMatchButton" class="btn-secondary">
          üèüÔ∏è G√• til kampvisning
        </button>
        <span class="badge">Data gemmes kun, mens denne side er √•ben.</span>
      </div>
    </section>

    <!-- Afsnit 12 ‚Äì Kampvisning -->
    <section id="matchSection" class="card hidden">
      <h2>Under kampen</h2>
      <p>
        Tryk p√• en spiller for at flytte vedkommende mellem
        <strong>P√• banen</strong> og <strong>Udskiftere</strong>. Tiden t√¶lles
        kun for de spillere, der er p√• banen.
      </p>

      <div class="timer-row">
        <div>
          <span class="timer-label">Kampur</span>
          <span class="timer-display" id="matchClock">00:00</span>
        </div>
        <div style="display: flex; gap: 0.4rem; flex-wrap: wrap;">
          <button id="toggleTimerButton" class="btn-primary">
            ‚ñ∂Ô∏è Start tid
          </button>
          <button id="newMatchButton" class="btn-secondary">
            üîÅ Ny kamp
          </button>
          <button id="resetTimerButton" class="btn-danger">
            ‚õî Nulstil alle tider
          </button>
        </div>
      </div>

      <!-- Nye kamp-handlinger inkl. tilf√∏j spiller under kamp -->
      <div class="match-actions">
        <button id="addLatePlayerButton" class="btn-secondary">
          ‚ûï Tilf√∏j spiller (sen ankomst)
        </button>
        <button id="allOnButton" class="btn-soft">S√¶t alle p√• banen</button>
        <button id="allOffButton" class="btn-soft">T√∏m banen</button>
      </div>

      <div class="columns">
        <div class="column">
          <div class="column-header">
            <span>P√• banen</span>
          </div>
          <div id="onFieldList" class="player-column"></div>
        </div>
        <div class="column">
          <div class="column-header">
            <span>Udskiftere</span>
          </div>
          <div id="benchList" class="player-column"></div>
        </div>
      </div>
    </section>

    <!-- Afsnit 13 ‚Äì Statistik -->
    <section id="statsSection" class="card hidden">
      <h2>Spilletid pr. spiller</h2>
      <p>
        Brug oversigten til at se, om alle f√•r nogenlunde lige meget spilletid.
        Udskiftere viser, hvor meget tid de mangler i forhold til den spiller,
        der har v√¶ret l√¶ngst p√• banen.
      </p>

      <table>
        <thead>
          <tr>
            <th>Spiller</th>
            <th>Spilletid</th>
            <th>Mangler</th>
          </tr>
        </thead>
        <tbody id="statsBody"></tbody>
        <tfoot>
          <tr>
            <td>Samlet kampur</td>
            <td id="statsTotal">00:00</td>
            <td></td>
          </tr>
        </tfoot>
      </table>

      <div class="stats-note">
        Tip: Brug ‚ÄúNy kamp‚Äù, n√•r kampen eller kampen i et st√¶vne er slut. Det
        nulstiller alle tider, men beholder spillerlisten.
      </div>
    </section>

    <footer>
      K√∏rer kun lokalt i browseren ‚Äì ingen data sendes ud af tr√¶nerens enhed.
    </footer>
  </div>

  <script>
    // Afsnit 14 ‚Äì Data-strukturer
    const players = [];
    let nextPlayerId = 1;

    let timerRunning = false;
    let timerId = null;
    let totalSeconds = 0;

    let currentView = "players";

    // Afsnit 15 ‚Äì Hj√¶lpefunktioner (DOM + formatering)
    function $(id) {
      return document.getElementById(id);
    }

    function formatClock(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
    }

    function formatMissing(seconds) {
      const rounded = Math.ceil(seconds);
      if (rounded <= 0) return "Mangler 0 sek";

      const minutes = Math.floor(rounded / 60);
      const secs = rounded % 60;

      const parts = [];
      if (minutes > 0) parts.push(minutes + " min");
      if (secs > 0) parts.push(secs + " sek");

      return "Mangler " + parts.join(" ");
    }

    function getMaxPlayedSeconds() {
      if (players.length === 0) return 0;
      return Math.max(...players.map((p) => p.secondsOnField));
    }

    // Afsnit 16 ‚Äì Visning / navigation
    function setActiveNav(view) {
      const buttons = document.querySelectorAll(".nav-btn");
      buttons.forEach((btn) => {
        const v = btn.getAttribute("data-view");
        btn.classList.toggle("active", v === view);
      });
    }

    function showView(view) {
      currentView = view;
      setActiveNav(view);

      $("setupSection").classList.add("hidden");
      $("matchSection").classList.add("hidden");
      $("statsSection").classList.add("hidden");

      if (view === "players") {
        $("setupSection").classList.remove("hidden");
      } else if (view === "match") {
        $("matchSection").classList.remove("hidden");
        $("statsSection").classList.remove("hidden");
      } else if (view === "stats") {
        $("statsSection").classList.remove("hidden");
      }
    }

    // Afsnit 17 ‚Äì Render funktioner
    function renderPlayerSetupList() {
      const ul = $("playerList");
      if (players.length === 0) {
        ul.innerHTML = "<li>Ingen spillere endnu. Tilf√∏j en spiller ovenfor.</li>";
        return;
      }
      ul.innerHTML = "";
      players.forEach((p) => {
        const li = document.createElement("li");
        li.classList.add("setup-player-row");

        const nameSpan = document.createElement("span");
        nameSpan.classList.add("setup-player-name");
        nameSpan.textContent = p.name;

        const iconWrap = document.createElement("span");
        iconWrap.classList.add("setup-icons");

        const editSpan = document.createElement("span");
        editSpan.classList.add("setup-player-edit");
        editSpan.textContent = "‚úèÔ∏è";
        editSpan.title = "Rediger spillernavn";
        editSpan.addEventListener("click", () => {
          editPlayerName(p.id);
        });

        const removeSpan = document.createElement("span");
        removeSpan.classList.add("setup-player-remove");
        removeSpan.textContent = "üèÉ‚Äç‚ôÇÔ∏è";
        removeSpan.title = "Slet spiller (g√•r hjem)";
        removeSpan.addEventListener("click", () => {
          deletePlayer(p.id);
        });

        iconWrap.appendChild(editSpan);
        iconWrap.appendChild(removeSpan);

        li.appendChild(nameSpan);
        li.appendChild(iconWrap);
        ul.appendChild(li);
      });
    }

    function renderMatchLists() {
      const onFieldContainer = $("onFieldList");
      const benchContainer = $("benchList");
      onFieldContainer.innerHTML = "";
      benchContainer.innerHTML = "";

      const maxPlayed = getMaxPlayedSeconds();

      players.forEach((player) => {
        const btn = document.createElement("button");
        btn.classList.add("player-btn");
        btn.classList.add(player.isOnField ? "player-on" : "player-off");

        const content = document.createElement("div");
        content.classList.add("player-content");

        const nameSpan = document.createElement("span");
        nameSpan.classList.add("player-name");
        nameSpan.textContent = player.name;

        const timeSpan = document.createElement("span");
        timeSpan.classList.add("player-time");

        if (player.isOnField) {
          // P√• banen: normal spilletid
          timeSpan.textContent =
            "Spilletid: " + formatClock(player.secondsOnField);
        } else {
          // Udskifter: Manglende tid p√• banen
          let diff = 0;
          if (maxPlayed > 0) {
            diff = Math.max(0, maxPlayed - player.secondsOnField);
          }
          const plainMissing =
            diff > 0
              ? formatMissing(diff).replace(/^Mangler\s*/, "")
              : "0 sek";
          timeSpan.classList.add("player-missing");
          timeSpan.textContent =
            "Manglende tid p√• banen: " + plainMissing;
        }

        content.appendChild(nameSpan);
        content.appendChild(timeSpan);

        const iconWrap = document.createElement("span");
        iconWrap.classList.add("player-icons");

        const editSpan = document.createElement("span");
        editSpan.classList.add("player-edit");
        editSpan.textContent = "‚úèÔ∏è";
        editSpan.title = "Rediger spillernavn";
        editSpan.addEventListener("click", (ev) => {
          ev.stopPropagation();
          editPlayerName(player.id);
        });

        const removeSpan = document.createElement("span");
        removeSpan.classList.add("player-remove");
        removeSpan.textContent = "üèÉ‚Äç‚ôÇÔ∏è";
        removeSpan.title = "Slet spiller (g√•r hjem / udvist)";
        removeSpan.addEventListener("click", (ev) => {
          ev.stopPropagation();
          deletePlayer(player.id);
        });

        iconWrap.appendChild(editSpan);
        iconWrap.appendChild(removeSpan);

        btn.appendChild(content);
        btn.appendChild(iconWrap);

        btn.addEventListener("click", () => {
          togglePlayerOnField(player.id);
        });

        if (player.isOnField) {
          onFieldContainer.appendChild(btn);
        } else {
          benchContainer.appendChild(btn);
        }
      });
    }

    function renderStats() {
      const body = $("statsBody");
      body.innerHTML = "";

      const maxPlayed = getMaxPlayedSeconds();

      players.forEach((p) => {
        const tr = document.createElement("tr");
        const tdName = document.createElement("td");
        const tdTime = document.createElement("td");
        const tdMissing = document.createElement("td");

        tdName.textContent = p.name;
        tdTime.textContent = formatClock(p.secondsOnField);

        const diff = maxPlayed - p.secondsOnField;
        tdMissing.textContent = diff > 0 ? formatMissing(diff) : "‚Äî";

        tr.appendChild(tdName);
        tr.appendChild(tdTime);
        tr.appendChild(tdMissing);
        body.appendChild(tr);
      });

      $("statsTotal").textContent = formatClock(totalSeconds);
      $("matchClock").textContent = formatClock(totalSeconds);
    }

    function fullRender() {
      renderPlayerSetupList();
      renderMatchLists();
      renderStats();
    }

    // Afsnit 18 ‚Äì Spillere
    function addPlayer(name) {
      const trimmed = name.trim();
      if (!trimmed) return;

      players.push({
        id: nextPlayerId++,
        name: trimmed,
        secondsOnField: 0,
        isOnField: false,
      });

      fullRender();
    }

    function editPlayerName(id) {
      const player = players.find((p) => p.id === id);
      if (!player) return;
      const newName = prompt("Nyt navn til spilleren:", player.name);
      if (!newName) return;
      const trimmed = newName.trim();
      if (!trimmed) return;
      player.name = trimmed;
      fullRender();
    }

    function deletePlayer(id) {
      const index = players.findIndex((p) => p.id === id);
      if (index === -1) return;

      const name = players[index].name;
      const ok = confirm(
        'Vil du slette spilleren "' + name + '" helt fra holdet?'
      );
      if (!ok) return;

      players.splice(index, 1);

      if (players.length === 0) {
        pauseTimer();
        totalSeconds = 0;
      }

      fullRender();
    }

    function togglePlayerOnField(id) {
      const player = players.find((p) => p.id === id);
      if (!player) return;
      player.isOnField = !player.isOnField;
      renderMatchLists();
      renderStats();
    }

    function setAllOnField(value) {
      players.forEach((p) => {
        p.isOnField = value;
      });
      renderMatchLists();
      renderStats();
    }

    // Afsnit 19 ‚Äì Tilf√∏j spiller under kamp
    function addLatePlayer() {
      const name = prompt("Navn p√• ny spiller (sen ankomst):");
      if (!name) return;
      addPlayer(name);
      showView("match");
    }

    // Afsnit 20 ‚Äì Timer-logik
    function startTimer() {
      if (timerRunning) return;
      if (players.length === 0) {
        alert("Tilf√∏j spillere f√∏r du starter tiden.");
        return;
      }
      timerRunning = true;
      $("toggleTimerButton").textContent = "‚è∏Ô∏è Pause tid";

      timerId = setInterval(() => {
        totalSeconds++;

        players.forEach((p) => {
          if (p.isOnField) {
            p.secondsOnField++;
          }
        });

        renderMatchLists();
        renderStats();
      }, 1000);
    }

    function pauseTimer() {
      if (!timerRunning) return;
      timerRunning = false;
      $("toggleTimerButton").textContent = "‚ñ∂Ô∏è Start tid";
      clearInterval(timerId);
      timerId = null;
    }

    function toggleTimer() {
      if (timerRunning) {
        pauseTimer();
      } else {
        startTimer();
      }
    }

    function resetAllTimes() {
      if (
        !confirm(
          "Vil du nulstille alle tider for denne kamp?\nSpillerlisten beholdes."
        )
      ) {
        return;
      }

      pauseTimer();
      totalSeconds = 0;
      players.forEach((p) => {
        p.secondsOnField = 0;
      });
      fullRender();
    }

    function newMatch() {
      if (players.length === 0) {
        alert("Tilf√∏j spillere f√∏r du starter en kamp.");
        showView("players");
        return;
      }

      if (
        !confirm(
          "Starte ny kamp?\nAlle tider nulstilles og alle spillere flyttes til udskiftere."
        )
      ) {
        return;
      }

      pauseTimer();
      totalSeconds = 0;
      players.forEach((p) => {
        p.secondsOnField = 0;
        p.isOnField = false;
      });

      fullRender();
      showView("match");
    }

    // Afsnit 21 ‚Äì Tema-skift
    function toggleTheme() {
      const body = document.body;
      const btn = $("themeToggleButton");

      if (body.classList.contains("theme-dark")) {
        body.classList.remove("theme-dark");
        body.classList.add("theme-light");
        btn.textContent = "üåô M√∏rk";
      } else {
        body.classList.remove("theme-light");
        body.classList.add("theme-dark");
        btn.textContent = "‚òÄÔ∏è Lys";
      }
    }

    // Afsnit 22 ‚Äì Init og events
    document.addEventListener("DOMContentLoaded", () => {
      const nameInput = $("playerNameInput");
      const addBtn = $("addPlayerButton");
      const startMatchBtn = $("startMatchButton");
      const toggleTimerBtn = $("toggleTimerButton");
      const resetTimerBtn = $("resetTimerButton");
      const newMatchBtn = $("newMatchButton");
      const newMatchTopBtn = $("newMatchTopButton");
      const themeToggleBtn = $("themeToggleButton");
      const allOnBtn = $("allOnButton");
      const allOffBtn = $("allOffButton");
      const addLatePlayerBtn = $("addLatePlayerButton");

      // nav-knapper
      document.querySelectorAll(".nav-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const view = btn.getAttribute("data-view");
          showView(view);
        });
      });

      // tilf√∏j spiller (setup)
      addBtn.addEventListener("click", () => {
        addPlayer(nameInput.value);
        nameInput.value = "";
        nameInput.focus();
      });

      nameInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          addPlayer(nameInput.value);
          nameInput.value = "";
        }
      });

      // kampvisning
      startMatchBtn.addEventListener("click", () => {
        if (players.length === 0) {
          alert("Tilf√∏j mindst √©n spiller, f√∏r du g√•r til kampvisning.");
          return;
        }
        showView("match");
      });

      toggleTimerBtn.addEventListener("click", toggleTimer);
      resetTimerBtn.addEventListener("click", resetAllTimes);
      newMatchBtn.addEventListener("click", newMatch);
      newMatchTopBtn.addEventListener("click", newMatch);

      themeToggleBtn.addEventListener("click", toggleTheme);

      allOnBtn.addEventListener("click", () => setAllOnField(true));
      allOffBtn.addEventListener("click", () => setAllOnField(false));

      addLatePlayerBtn.addEventListener("click", addLatePlayer);

      // f√∏rste visning
      showView("players");
      fullRender();
    });
  </script>
</body>
</html>
